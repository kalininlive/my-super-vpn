# MTProto Proxy + Grafana Dashboard

Свой MTProto Proxy для Telegram с личным кабинетом (Grafana) для мониторинга статистики.

## Что это

- **MTProto Proxy** — прокси-сервер для Telegram с Fake-TLS маскировкой
- **Grafana Dashboard** — личный кабинет со статистикой (соединения, трафик, безопасность)
- **Промо-канал** — ваш Telegram-канал закрепляется у всех пользователей прокси

## Быстрый старт

### 1. Арендуйте VPS

Нужен сервер **за пределами России** (Нидерланды, Германия, Финляндия).

| Провайдер | Цена | Примечание |
|---|---|---|
| [Aeza.net](https://aeza.net) | от $3/мес | Принимает RU-карты |
| [Timeweb Cloud](https://timeweb.cloud) | от 199 руб/мес | Русскоязычный |
| [Hetzner](https://hetzner.com) | от 3.79 EUR/мес | Надежный |

**Требования:** Ubuntu 22.04+, 512 MB RAM, 1 vCPU

### 2. Получите SECRET в Telegram

1. Откройте бота **@MTProxybot**
2. Отправьте `/newproxy`
3. Введите **IP сервера** и **порт 443**
4. Бот попросит **secret** — сгенерируйте 32 hex-символа: `openssl rand -hex 16`
5. Скопируйте **proxy tag** который выдаст бот

### 3. Установите на сервер

```bash
# Скачать
git clone https://github.com/kalininlive/my-super-vpn.git
cd my-super-vpn

# Настроить сервер (Docker, фаервол, fail2ban)
chmod +x setup-vps.sh && ./setup-vps.sh

# Запустить прокси + дашборд
chmod +x with-dashboard/deploy.sh && cd with-dashboard && ./deploy.sh
```

Скрипт спросит SECRET, настроит Fake-TLS и поднимет 3 контейнера.

### 4. Готово!

- **Прокси:** `tg://proxy?server=ВАШ_IP&port=443&secret=ВАШ_СЕКРЕТ`
- **Grafana:** `http://ВАШ_IP:3000`

---

## Привязка домена (вместо IP)

Чтобы пользователи не видели ваш IP в ссылке:

### Шаг 1. Купите домен

Любой регистратор: Namecheap, Cloudflare, reg.ru и т.д.

### Шаг 2. Добавьте DNS-записи

В панели управления доменом создайте A-записи:

| Тип | Имя | Значение | TTL |
|---|---|---|---|
| A | `proxy` | `IP_ВАШЕГО_СЕРВЕРА` | 300 |
| A | `dashboard` | `IP_ВАШЕГО_СЕРВЕРА` | 300 |

### Шаг 3. Используйте домен в ссылке

```
tg://proxy?server=proxy.ваш-домен.com&port=443&secret=ВАШ_СЕКРЕТ
```

Grafana будет доступна по: `http://dashboard.ваш-домен.com:3000`

### Преимущества домена

- Пользователи не видят IP
- При смене сервера (блокировка РКН) — просто обновите A-запись
- Не нужно раздавать новые ссылки

---

## Промо-канал (спонсорский канал)

Чтобы ваш канал закреплялся у всех пользователей прокси:

1. Откройте **@MTProxybot** в Telegram
2. Выберите свой прокси из списка
3. Нажмите **"Promoted Channel"**
4. Укажите `@username` вашего канала
5. Готово — у всех пользователей канал будет закреплен вверху

---

## Grafana Dashboard

Личный кабинет показывает в реальном времени:

| Панель | Метрика |
|---|---|
| Активные соединения | Сколько пользователей онлайн |
| Соединения с Telegram DC | Связь с серверами Telegram |
| Трафик (скорость) | Входящий/исходящий в байт/сек |
| Общий объём трафика | Суммарный трафик за период |
| Replay-атаки | Обнаруженные попытки атак |
| Domain Fronting | Соединения через маскировку |

---

## Управление

```bash
cd /opt/mtproto-dashboard

# Логи
docker compose logs -f mtproto-proxy

# Перезапуск
docker compose restart

# Остановка
docker compose down

# Запуск
docker compose up -d
```

---

## Когда РКН заблокирует IP

1. Арендуйте **новый VPS**
2. Повторите установку (шаг 3)
3. **Если есть домен** — просто обновите A-запись на новый IP
4. **Если нет домена** — опубликуйте новую ссылку в своем канале
5. В @MTProxybot обновите IP прокси

---

## Структура проекта

```
.
├── setup-vps.sh                           # Настройка сервера
├── deploy-mtproto.sh                      # Простой деплой (без дашборда)
├── manage.sh                              # CLI управление
└── with-dashboard/                        # Полный стек с Grafana
    ├── deploy.sh                          # Деплой с дашбордом
    ├── docker-compose.yml                 # mtg + Prometheus + Grafana
    ├── mtg-config.toml                    # Шаблон конфига прокси
    ├── prometheus/
    │   └── prometheus.yml                 # Сбор метрик
    └── grafana/
        ├── provisioning/
        │   ├── datasources/datasource.yml
        │   └── dashboards/dashboards.yml
        └── dashboards/
            └── mtproto-proxy.json         # Готовый дашборд
```

---

## FAQ

**Это VPN?**
Нет. MTProto Proxy работает только для Telegram.

**Можно поставить VPN на тот же сервер?**
Да. WireGuard/OpenVPN не конфликтуют с MTProto Proxy.

**Сколько стоит?**
От $3-5/мес за VPS.

**Сколько пользователей потянет?**

| Пользователей | RAM | Трафик/мес |
|---|---|---|
| до 100 | 512 MB | ~100 GB |
| 100-500 | 1 GB | ~500 GB |
| 500-2000 | 2 GB | ~2 TB |
